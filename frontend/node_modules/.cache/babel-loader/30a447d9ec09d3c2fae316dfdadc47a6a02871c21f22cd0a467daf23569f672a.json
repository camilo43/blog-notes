{"ast":null,"code":"/*\n * routing-stream.js: A Stream focused on connecting an arbitrary RequestStream and\n * ResponseStream through a given Router.\n *\n * (C) 2011, Charlie Robbins & the Contributors\n * MIT LICENSE\n *\n */\n\nvar util = require('util'),\n  union = require('./index'),\n  RequestStream = require('./request-stream'),\n  ResponseStream = require('./response-stream');\n\n//\n// ### function RoutingStream (options)\n//\n//\nvar RoutingStream = module.exports = function (options) {\n  options = options || {};\n  RequestStream.call(this, options);\n  this.before = options.before || [];\n  this.after = options.after || [];\n  this.response = options.response || options.res;\n  this.headers = options.headers || {\n    'x-powered-by': 'union ' + union.version\n  };\n  this.target = new ResponseStream({\n    response: this.response,\n    headers: this.headers\n  });\n  this.once('pipe', this.route);\n};\nutil.inherits(RoutingStream, RequestStream);\n\n//\n// Called when this instance is piped to **by another stream**\n//\nRoutingStream.prototype.route = function (req) {\n  //\n  // When a `RoutingStream` is piped to:\n  //\n  // 1. Setup the pipe-chain between the `after` middleware, the abstract response\n  //    and the concrete response.\n  // 2. Attempt to dispatch to the `before` middleware, which represent things such as\n  //    favicon, static files, application routing.\n  // 3. If no match is found then pipe to the 404Stream\n  //\n  var self = this,\n    after,\n    error,\n    i;\n\n  //\n  // Don't allow `this.target` to be writable on HEAD requests\n  //\n  this.target.writable = req.method !== 'HEAD';\n\n  //\n  // 1. Setup the pipe-chain between the `after` middleware, the abstract response\n  //    and the concrete response.\n  //\n  after = [this.target].concat(this.after, this.response);\n  for (i = 0; i < after.length - 1; i++) {\n    //\n    // attach req and res to all streams\n    //\n    after[i].req = req;\n    after[i + 1].req = req;\n    after[i].res = this.response;\n    after[i + 1].res = this.response;\n    after[i].pipe(after[i + 1]);\n\n    //\n    // prevent multiple responses and memory leaks\n    //\n    after[i].on('error', this.onError);\n  }\n\n  //\n  // Helper function for dispatching to the 404 stream.\n  //\n  function notFound() {\n    error = new Error('Not found');\n    error.status = 404;\n    self.onError(error);\n  }\n\n  //\n  // 2. Attempt to dispatch to the `before` middleware, which represent things such as\n  //    favicon, static files, application routing.\n  //\n  (function dispatch(i) {\n    if (self.target.modified) {\n      return;\n    } else if (++i === self.before.length) {\n      //\n      // 3. If no match is found then pipe to the 404Stream\n      //\n      return notFound();\n    }\n    self.target.once('next', dispatch.bind(null, i));\n    if (self.before[i].length === 3) {\n      self.before[i](self, self.target, function (err) {\n        if (err) {\n          self.onError(err);\n        } else {\n          self.target.emit('next');\n        }\n      });\n    } else {\n      self.before[i](self, self.target);\n    }\n  })(-1);\n};\nRoutingStream.prototype.onError = function (err) {\n  this.emit('error', err);\n};","map":{"version":3,"names":["util","require","union","RequestStream","ResponseStream","RoutingStream","module","exports","options","call","before","after","response","res","headers","version","target","once","route","inherits","prototype","req","self","error","i","writable","method","concat","length","pipe","on","onError","notFound","Error","status","dispatch","modified","bind","err","emit"],"sources":["/Users/juancvegao/Documents/PROGRAMMING/REACT/ejerciciosUniversidad/notes_github/frontend/node_modules/union/lib/routing-stream.js"],"sourcesContent":["/*\n * routing-stream.js: A Stream focused on connecting an arbitrary RequestStream and\n * ResponseStream through a given Router.\n *\n * (C) 2011, Charlie Robbins & the Contributors\n * MIT LICENSE\n *\n */\n\nvar util = require('util'),\n    union = require('./index'),\n    RequestStream = require('./request-stream'),\n    ResponseStream = require('./response-stream');\n\n//\n// ### function RoutingStream (options)\n//\n//\nvar RoutingStream = module.exports = function (options) {\n  options = options || {};\n  RequestStream.call(this, options);\n\n  this.before = options.before || [];\n  this.after = options.after || [];\n  this.response = options.response || options.res;\n  this.headers = options.headers || {\n    'x-powered-by': 'union ' + union.version\n  };\n\n  this.target = new ResponseStream({\n    response: this.response,\n    headers: this.headers\n  });\n\n  this.once('pipe', this.route);\n};\n\nutil.inherits(RoutingStream, RequestStream);\n\n//\n// Called when this instance is piped to **by another stream**\n//\nRoutingStream.prototype.route = function (req) {\n  //\n  // When a `RoutingStream` is piped to:\n  //\n  // 1. Setup the pipe-chain between the `after` middleware, the abstract response\n  //    and the concrete response.\n  // 2. Attempt to dispatch to the `before` middleware, which represent things such as\n  //    favicon, static files, application routing.\n  // 3. If no match is found then pipe to the 404Stream\n  //\n  var self = this,\n      after,\n      error,\n      i;\n\n  //\n  // Don't allow `this.target` to be writable on HEAD requests\n  //\n  this.target.writable = req.method !== 'HEAD';\n\n  //\n  // 1. Setup the pipe-chain between the `after` middleware, the abstract response\n  //    and the concrete response.\n  //\n  after = [this.target].concat(this.after, this.response);\n  for (i = 0; i < after.length - 1; i++) {\n    //\n    // attach req and res to all streams\n    //\n    after[i].req     = req;\n    after[i + 1].req = req;\n    after[i].res     = this.response;\n    after[i + 1].res = this.response;\n    after[i].pipe(after[i + 1]);\n\n    //\n    // prevent multiple responses and memory leaks\n    //\n    after[i].on('error', this.onError);\n  }\n\n  //\n  // Helper function for dispatching to the 404 stream.\n  //\n  function notFound() {\n    error = new Error('Not found');\n    error.status = 404;\n    self.onError(error);\n  }\n\n  //\n  // 2. Attempt to dispatch to the `before` middleware, which represent things such as\n  //    favicon, static files, application routing.\n  //\n  (function dispatch(i) {\n    if (self.target.modified) {\n      return;\n    }\n    else if (++i === self.before.length) {\n      //\n      // 3. If no match is found then pipe to the 404Stream\n      //\n      return notFound();\n    }\n\n    self.target.once('next', dispatch.bind(null, i));\n    if (self.before[i].length === 3) {\n      self.before[i](self, self.target, function (err) {\n        if (err) {\n          self.onError(err);\n        } else {\n          self.target.emit('next');\n        }\n      });\n    }\n    else {\n      self.before[i](self, self.target);\n    }\n  })(-1);\n};\n\nRoutingStream.prototype.onError = function (err) {\n  this.emit('error', err);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}